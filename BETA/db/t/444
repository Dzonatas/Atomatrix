o6 p449 c0 s448 l447 c0 w0 p0 v12
name	(444,895)	$ Text Display
window	(444,219)	?
gc	(444,219)	?
font	(444,219)	?
cx	(6,219)	# 16
cy	(6,219)	# 192
text	(6,219)	A 26
A 80
$ )
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ s
$ k
$ m
$ s
$ k
$ s
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ )
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ k
$ m
$ s
$ k
$ m
$ s
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ )
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ s
$ k
$ s
$ m
$ k
$ s
$ m
$ s
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ )
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ s
$ k
$ m
$ s
$ k
$ k
$ m
$ s
$ k
$ m
$ s
$ k
$ m
$ s
$ k
$ m
$ s
$ k
$ m
$ s
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ )
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ .
$ s
$ l
$ k
$ s
$ l
$ k
$ s
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ )
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ ,
$ s
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$ )
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 80
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
$  
A 0
x	(6,27)	# 2
y	(6,27)	# 12
buf	(6,219)	A 0
pos	(6,219)	# 0
cursor_hidden	(6,219)	?
.
crlf (0)
.x = 0;
.y += 1;
.y => 25 ? {
	.y = 24;
	scroll();
	}

scroll (0)
.gc copyarea(0, .font.height, 640, 400 - .font.height, 0, 0);
.gc cleararea(0, 400 - .font.height, 640, 400);
popl(.text);
x=0;
pushr(.text,{});
[x < 80] {
	pushr(.text[24]," ");
	x += 1;
	}

showcursor (0)
.gc fillrectangle(.cx, .cy, .font.width, .font.height);

hidecursor (0)
.gc cleararea( .cx, .cy, .font.width, .font.height);
.gc drawstring(.cx, .cy + .font.ascent, .text[.y][.x]);

keypress (0)
~~argv[0].key ? {
/*
	 textate(argv[0].keycode); 
*/
	
	argv[0].keycode == 36 ? {
		hidecursor();
		crlf();
/*
		textate(+.buf);
*/
		.buf = {};
		prompt();
		updatecursor();
		showcursor();
		flush();
		}
	argv[0].keycode == 9 ? {
		destroy();
		!
		}
	argv[0].keycode == 22 ? {
		.buf length() == 0 ? !
		.x == 0 ? !
		hidecursor();
		.pos -= 1;
		popr(.buf);
		delch();
		updatecursor();
		showcursor();
		flush();
		!
		}
	!
	}

hidecursor();

addch(argv[0].key);

pushr(.buf,argv[0].key);
.pos += 1;

updatecursor();
showcursor();
flush();

show (0)
.sub map();
.window map();
flush();

create (0)
:testmsg();
.window		= $X.window();
.window.x	= 4;
.window.y	= 4;
.window.width	= 640;
.window.height	= 400;
.window.background = .grey;
.window create(447.window);

enableevents();
:setactive(this);

.gc	= $X.gc(.window);
.font	= $X.font("8x16");

c = $X.color(0,0,0);

.gc setforeground(c);
.gc setfont(.font);

.text	= {{}};
.x	= 0;
.y	= 0;
y = 0;
[y < 25] {
	x = 0;
	pushr(.text, {});
	[x < 80] {
		pushr(.text[y], " ");
		x += 1;
		}
	y += 1;
	}

.buf	= {};
.pos	= 0;

updatecursor();
prompt();

hide (0)
.window unmap();
.siub unmap();
flush();

destroy (0)
disableevents();
:destroy();

expose (0)
y = 0;
[y < 25] {
	x = 0;
	t = ascii(+.text[y]);
	.gc drawstring(0, (y * .font.height) + .font.ascent, t);
	y += 1;
	}
showcursor();
flush();

updatecursor (0)
.cx = .x * .font.width;
.cy = .y * .font.height;

print (0)
i=0;
len = argv[0] length();
[i < len] {
	addch(argv[0][i]);
	i += 1;
	}

prompt (0)
.x <> 0 ? crlf();
updatecursor();
print(") ");
updatecursor();
showcursor();

addch (0)
.gc drawstring(.cx, .cy + .font.ascent, argv[0]);
.text[.y][.x] = argv[0];
.x += 1;
updatecursor();
.x => 80 ? { crlf(); updatecursor(); }


delch (0)
.x == 0 ? !
.x -= 1;
updatecursor();
.gc cleararea(.cx, .cy + .font.ascent, .font.width, .font.height);
.text[.y][.x] = " ";

notify (0)
~~.window ? !
hidecursor();
crlf();
updatecursor();
[ l; argv[0] split("\n") ]
	{
	print(l);
	updatecursor();
	crlf();
	updatecursor();
	}
prompt();
showcursor();
flush();

flush (0)
$X.flush();

